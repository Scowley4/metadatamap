<!-- HTML FILE FOR THE TEAMING STUDY TASK UI -->
<!DOCTYPE html>
<html>
  <head>
    <link href="https://fonts.googleapis.com/css?family=Arvo" rel="stylesheet"/>
    <link href="https://fonts.googleapis.com/css?family=Roboto:400,700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="static/styles/teaming.css"/>
    <link rel="stylesheet" href="static/styles/modal.css"/>
    <title>Debate Labeling Task</title>
  </head>
  <body>

    <div id="app">
      <div class="header">
      <div>
        <!--<strong class="inline large">Label Debates</strong> -->
        <strong class="right inline user-id">USER ID: {{ userId }} </strong>
      </div>

      </br>
      <div>
        <strong> # Documents You've Labeled: {{ labeledCount }} </strong>
        <strong id="timer-box"
             class="right time-remaining"
             title="task time remaining">
          Time Remaining: {{ prettyTime }}
        </strong>
      </div>
      <div>
        <button class="save-button"
                v-on:click="sendUpdate"
                title="save input and get new set of debates">
          Save {{ perceivedControl ? "Assignments" : "Suggestions" }} and Get New Set of Debates
        </button>
        <button v-on:click='toggleModal()' class="right" title="show instructions">View Instructions</button>

      <!--  <button v-on:click='labelAllCorrect'>Cheat</button> -->

          <!-- <button v-on:click="getAccuracy">Get Accuracy</button>-->
        </br>
      </div>
    </div>

      <div id="doc-list"
           v-if="isMounted">
        <!--
        <div class="doc-container-collapsed doc-container doc-header">
          <div class="expand-button-area"></div>
          <div class="title">Doc Identifier</div>
          <div class="rating">Model Prediction</div>
          <div class="radio">
            {{ perceivedControl ? "Assign Label" : "Suggest Label" }}
          </div>
        </div>
        -->
        <div v-for="doc in unlabeledDocs"
             class="doc-container"
             v-bind:class="doc.open ? 'doc-container-expanded' : 'doc-container-collapsed'">
          <div class="expand-button-area">
            <button class="expand-button"
                    v-on:click="toggleDocOpen(doc)">
              <span v-if="doc.open">
              -
              </span>
              <span v-else>
              +
              </span>
            </button>
          </div>
          <div class="title">
            <div class="vertical-align">
              Debate </br>
              #{{ pad(doc.docId, 6) }}
            </div>
          </div>
          <div class="rating">
            <div>
              <div class="vertical-align large-label">
                Model Prediction:
              </div>
            </div>
            <div class="model-prediction rounded" v-bind:style="{'background-color': colors[doc.prediction.label]}">
              {{ getConfidenceWord(doc) }} {{ expandLabel(doc.prediction.label) }}
            </div>
          </div>

          <div class="radio">
            <span v-if="showAnswers">
              {{ labels[0].label === doc.trueLabel ? '&#10004;' : '&#10005;' }}
            </span>
            <div class="radio-container">
              <div>
                <div class="vertical-align large-label">
                  {{ perceivedControl ? "Your Assigned Label:" : "Your Suggested Label:" }}
                </div>
              </div>
              <button class="radio-selection"
                      v-on:click="labelDoc(doc, labels[0].label+'1')"
                      v-bind:style="{'background-color': colors[labels[0].label]}">
                 {{ expandLabel(labels[0].label) }}</br>
                <input type="radio"
                       v-bind:value="labels[0].label+'1'"
                       v-model="doc.userLabel"/>
              </button>

              <button class="radio-selection"
                      v-if="inputUncertainty"
                      v-on:click="labelDoc(doc, labels[0].label+'2')"
                      v-bind:style="{'background-color':
                      lightenDarkenColor(colors[labels[0].label], -40)}">
                Possibly {{ expandLabel(labels[0].label) }}
                </br>
                <input type="radio"
                       v-bind:value="labels[0].label+'2'"
                       v-model="doc.userLabel"/>
              </button>

              <button class="radio-selection"
                      v-if="inputUncertainty"
                      v-on:click="labelDoc(doc, labels[1].label+'2')"
                      v-bind:style="{'background-color':
                      lightenDarkenColor(colors[labels[1].label], -40)}">
                Possibly {{ expandLabel(labels[1].label) }}
                </br>
                <input type="radio"
                       v-bind:value="labels[1].label+'2'"
                       v-model="doc.userLabel"/>
              </button>

              <button class="radio-selection"
                      v-on:click="labelDoc(doc, labels[1].label+'1')"
                      v-bind:style="{'background-color': colors[labels[1].label]}">
                 {{ expandLabel(labels[1].label) }}
                </br>
                <input type="radio"
                       v-bind:value="labels[1].label+'1'"
                       v-model="doc.userLabel"/>
              </button>
            </div>
          </div>
            <!--
            <label>My label
              <input style="display:block;"
                     type="radio"
                     id="something"
                     value="hello"
              \>
            </label>
            <label>
              Label1
              <input style="display:block;"
                     type="radio"
                     id="val1"
                     name="val"
                     value="hello"
                     />
            </label>
            <label>
              Label2
              <input style="display:block;"
                     type="radio"
                     id="val2"
                     name="val"
                     value="hello"
                     />
            </label>
            <label for="one">{{ expandLabel(labels[0].label) }}</label>
            <input type="radio"
                   id="one"
                   v-bind:value="labels[0].label+'O'"
                   v-model="doc.userLabel"/>
            <input type="radio"
                   id="one"
                   v-if="inputUncertainty"
                   v-bind:value="labels[0].label+'I'"
                   v-model="doc.userLabel"/>
            <input type="radio"
                   id="two"
                   v-if="inputUncertainty"
                   v-bind:value="labels[1].label+'I'"
                   v-model="doc.userLabel"/>
            <input type="radio"
                   id="two"
                   v-bind:value="labels[1].label+'O'"
                   v-model="doc.userLabel"/>
            <label for="two">{{ expandLabel(labels[1].label) }}</label>
            <span v-if="showAnswers">
              {{ labels[1].label === doc.trueLabel ? '&#10004;' : '&#10005;' }}
            </span>
            -->
          <div class="doc-text" v-if="doc.open">
            <!-- {{ doc.text }} -->
            <div v-html="getDocHtml(doc)"></div>
          </div>




        </div>
      </div> <!--end doc-list-->
    <transition name="fade"> <!-- MODAL -->
      <div class="modal-shell"
           v-show="showModal"
           v-on:click="closeModal()">
        <div class="modal-content instructions" v-on:click.stop>
          <div class="modal-header doc-header">
            <h2>
              <span v-if="!finishedSurvey">Welcome</span>
              <span v-if="!timeWarning && finishedSurvey && firstPage && !finished && !refreshed">Task Overview</span>
              <span v-if="!timeWarning && finishedSurvey && !firstPage && !finished && !refreshed">Tool Instructions</span> <!--for the debate labeling task-->
              <span v-if="finished">Post-Task Survey</span>
              <span v-if="timeWarning">Time is almost up!</span>
            </h2>
            <button class="btn-close"
                    v-on:click="closeModal()"
                    v-if="started && !finished && !refreshed">
              &times;
            </button>
          </div>
          <div class="modal-body">
            <span v-if="timeWarning">
              You have 2 minutes remaining to confirm or correct the system predictions. At the end of task time, all of your outstanding {{perceivedControl ? 'assignments' : 'suggestions' }} will be saved to the system.
            </span>
            <span v-if="refreshed">
              The system <span v-if="inputProvided">has updated the model by {{perceivedControl ? 'replacing those debate labels with the ones you assigned' : 'taking your suggested labels into account for deciding how to label those debates'}} and</span> has labeled ten new randomly chosen debates.
            </span>
            <span v-if="finished">
              Time is now up; any outstanding {{perceivedControl ? 'assignments' : 'suggestions' }} were saved to the system.
              <br/>
              <br/>
              Thank you for participating in the task. Please complete the following survey:
              <a href="https://forms.gle/DiVdwNuquTKGLjxV7" target="_blank">post-task survey</a>, with your assigned user id: {{userId}}
            </span>
            <span v-if="!timeWarning && !finishedSurvey && !finished && !refreshed">
              Welcome to the political party prediction task! Your assigned user id is: <span class="bold">{{userId}}</span>. Please write this down - you will need it for the surveys and to receive compensation for this task.
              <br/>
              <br/>
              Please first complete the following survey:
              <a v-on:click="clickedSurvey = true" target="_blank" href="https://forms.gle/XRLTyQTAYQZL4iTPA">pre-task survey</a>, which will open in a new tab or window. After completing the survey, return to this tab to continue the task.
            </span>
            <span v-if="!timeWarning && firstPage && finishedSurvey && !finished && !refreshed">
              <div>
                This is a political party prediction system that predicts if a speaker is a republican or democrat. It has been trained with a small set of debates for which the true political party is known. From these labeled debates, the system learns a model to distinguish republican and democrat speakers based on the words they use and the topics they discuss.
              </div>
              </br>
              </br>
              <div>
                In this task, <span class="bold">you and the system will predict the political party of the speakers for a large set of debate speeches</span>. There are too many speeches for you to read and predict the speakers’ political party for all of them on your own, but the system has only been trained on a small set of debates, so it needs your help to learn to better distinguish between republican and democrat speakers.
              </div>
              </br>
              </br>
              <div>
                For each speech, the system will predict the party affiliation of the speaker and highlight the words within the speech that are most important for that prediction. You will help the system learn to make better predictions by <span class="bold">{{ perceivedControl ? 'assigning' : 'suggesting' }} labels that correct or confirm the party affiliation of any of the speeches</span>.
              </div>
              </br>
              </br>
              <div>
                Your input could be incorporated in such a system in many ways, from overriding the systems predictions to being ignored completely. <span class="bold">This system incorporates your labels by updating the model to {{ perceivedControl ? "replace that debate's label with the one that you assign" : 'take your suggested label into account when deciding how to label that debate' }}.</span>
              </div>
              <img :src="getSliderUrl()" />
              </br>
              </br>
              <div>You will have <span class="bold">20 minutes</span> for this task. At the end of the task time, the system will label all the speeches using the updated model. You will be given up to a <span class="bold">$5 bonus for how many of the speeches are correctly labeled</span>.
              </div>
            </span>
            <span v-if="!timeWarning && !firstPage && finishedSurvey && !finished && !refreshed">
              <div>To begin, the system predicts the political party affiliation for ten randomly chosen debate speeches. For each speech,
              the tool will show the model's prediction and how sure it is. Clicking the + button next to the speech expands it to view the text. The highlighted words are those that are most important for the model's prediction. You {{ perceivedControl ? 'assign' : 'suggest' }} the political party label for the speaker by clicking the radio buttons. Clicking the button again clears the label.
              </br>
              </br>
              Clicking the "Save and Get New Set of Debates"
              button at any point saves your {{ perceivedControl ? 'assignments' : 'suggestions' }} to the system, which it {{ perceivedControl ? 'adheres to' : 'considers'}} when updating the model and predicting the party affiliation for the next random set of debates.
              </br>
              </br>
              Remember, the goal is to label as many debates as possible. As there isn't enough time to read and label all of the debates yourself, you'll help the system learn a model that distinguishes between republican and democrat speakers. After 20 minutes, the system will use the final version of the model to label the speeches, and you will be given <span class="bold">up to a $5 bonus based on how many out of thespeeches are correct.</span> You can revisit these instructions at any time by clicking the “View Instructions" button.
              </div>
            </span>
          </div> <!-- Modal body -->
          <div class="modal-footer">
            <button class="modal-button"
                    v-if="clickedSurvey && !finishedSurvey && !finished && !refreshed"
                    v-on:click="finishedSurvey = true">
              proceed to instructions
            </button>
            <button class="modal-button"
                    v-if="!timeWarning && firstPage && finishedSurvey && !finished && !refreshed"
                    v-on:click="firstPage = false">
              next
            </button>
            <button class="modal-button"
                    v-if="!timeWarning && !started && !firstPage && !finished && !refreshed"
                    v-on:click="startTask">
              start task
            </button>
            <button class="modal-button"
                    v-if="refreshed"
                    v-on:click="closeModal()">
              ok
            </button>
          </div>
        </div> <!-- Modal content -->
      </div> <!-- Modal shell -->
    </transition>
    <transition name="fade">
      <div v-if="loading"
           class="modal-shell">
        <img v-bind:src="'static/images/spinner.gif'"></img>
      </div>
    </transition>
    </div> <!-- End Vue App -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/axios/0.18.0/axios.min.js"></script>
    <script src="https://unpkg.com/vue"></script>
    <!-- <script src="https://cdn.jsdelivr.net/npm/vue"></script> -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
    <script src="static/script.js"></script>
  </body>
</html>
